{"remainingRequest":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\src\\views\\students\\components\\HouseMap.vue?vue&type=style&index=0&id=28fd7c38&lang=less&scoped=true&","dependencies":[{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\src\\views\\students\\components\\HouseMap.vue","mtime":1658367490896},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\001\\Desktop\\人才大脑图片\\wxy\\王飞\\项目\\web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQojYWxsbWFwIHsNCiAgd2lkdGg6IDEwMCU7DQogIGhlaWdodDogNTAwcHg7DQogIHBvc2l0aW9uOiByZWxhdGl2ZTsNCn0NCg0KI2FsbG1hcCB7DQogICYgL2RlZXAvIC5sb2dvLXRleHR7DQogICAgZGlzcGxheTogbm9uZTsNCiAgfQ0KICAmIC9kZWVwLyAucm90YXRlLWNpcmNsZSAuY29tcGFzcy1pbWd7DQogICAgbGVmdDogMDsNCiAgfQ0KICAmIC9kZWVwLyAucm90YXRlLWNpcmNsZSAucm90YXRlLWxlZnQtaW1new0KICAgIGxlZnQ6IDA7DQogIH0NCiAgJiAvZGVlcC8gLnJvdGF0ZS1jaXJjbGUgLnJvdGF0ZS1yaWdodC1pbWd7DQogICAgbGVmdDogMDsNCiAgfQ0KICAmIC9kZWVwLyAucm90YXRlLWNpcmNsZSAucm90YXRlLXRvcC1pbWd7DQogICAgbGVmdDogMDsNCiAgfQ0KICAmIC9kZWVwLyAucm90YXRlLWNpcmNsZSAucm90YXRlLWJvdHRvbS1pbWd7DQogICAgbGVmdDogMDsNCiAgfQ0KfQ0KDQoudG9vbHRpcCB7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgdG9wOiAxMHB4Ow0KICBsZWZ0OiA1MCU7DQogIC8vIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDMwcHg7DQogIGxpbmUtaGVpZ2h0OiAzMHB4Ow0KICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogIGJhY2tncm91bmQ6IHJnYmEoMCwgMCwgMCwgMC4zKTsNCiAgY29sb3I6ICNmMDA7DQogIHotaW5kZXg6IDEwMDAwOw0KICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTUwJSk7DQogIC8vIHdpZHRoOiAyNzBweDsNCiAgaGVpZ2h0OiA0NnB4Ow0KICBiYWNrZ3JvdW5kOiAjRkZEQ0RDOw0KICBib3JkZXI6IDFweCBzb2xpZCAjRDEwMTAwOw0KICBib3gtc2hhZG93OiAwcHggMHB4IDE5cHggMXB4IHJnYmEoMjA5LCAxLCAwLCAwLjUpOw0KICBib3JkZXItcmFkaXVzOiAxMHB4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICBhbGlnbi1pdGVtczogY2VudGVyOw0KICBwYWRkaW5nLXJpZ2h0OiAxMHB4Ow0KICBpbWcgew0KICAgIHdpZHRoOiAzMHB4Ow0KICAgIGhlaWdodDogMzBweDsNCiAgICBtYXJnaW4tcmlnaHQ6IDEwcHg7DQogICAgbWFyZ2luLWxlZnQ6IDEwcHg7DQogIH0NCn0NCi5tYXBCb3ggew0KICBwb3NpdGlvbjogcmVsYXRpdmU7DQogIC8vIG1pbi1oZWlnaHQ6IDY0MHB4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICAvLyBhbGlnbi1pdGVtczogY2VudGVyOw0KfQ0KDQo="},{"version":3,"sources":["HouseMap.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6MA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"HouseMap.vue","sourceRoot":"src/views/students/components","sourcesContent":["<template>\r\n<!-- 腾讯地图版 -->\r\n  <div class=\"mapBox\">\r\n    <div id=\"allmap\"></div>\r\n    <div class=\"tooltip\" v-show=\"!userInfo\">\r\n      <img src=\"../../../assets/imgs/houseList/zhuYi.svg\" alt=\"\">\r\n      您未登录，仅能查看地图房源\r\n      <!-- 您当前是未登录状态请先登录 -->\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { projectList, countHouseForMap, getStudentStatus } from '@/api/house.js';\r\nimport { mapState } from 'vuex';\r\nimport { getId } from \"../../../utils/auth\";\r\nimport { EventBus } from '@/event-bus.js';\r\nimport customOverlay from './customOverlay.js';\r\n\r\nexport default {\r\n  data() {\r\n    return {\r\n      projectList: [],\r\n      zoom: 11,\r\n\r\n      areaData: [], // 区域数据\r\n      projectData: [], // 具体项目数据\r\n      isAreaMarkerVisible: true,\r\n\r\n      areaLabelArr: [],\r\n      projectLabelArr: [],\r\n    }\r\n  },\r\n  created () {\r\n    // this.getData()\r\n  },\r\n  mounted() {\r\n    this.initBMap()\r\n    this.getData()\r\n\r\n    EventBus.$on('customAreaClick', e => {\r\n      this.toggleAreaLabelArr()\r\n      this.zoom = e\r\n    })\r\n\r\n    EventBus.$on('customProcjectClick', e => {\r\n      if(window.customProcjectClickFirst != true) return\r\n      window.customProcjectClickFirst = false\r\n\r\n      // 先判断是否登入\r\n      if(!this.userInfo) {\r\n        this.$router.push('/login')\r\n      }else{\r\n        // 查接口是否有资格 true -- 选房详情 ; false -- 申请\r\n        getStudentStatus({\r\n          studentId: getId(),\r\n          area: e.districtname || e.districtName,\r\n        }).then(res => {\r\n          console.log(res);\r\n          if(res.code != 200) {\r\n            this.$confirm(res.msg, '提示', {\r\n              confirmButtonText: '确定',\r\n              showCancelButton: false,\r\n              type: 'warning'\r\n            }).then(() => {\r\n              if(res.code == 201) {\r\n                this.$router.push('/reportOnlie')\r\n              }\r\n            }).catch(() => {\r\n\r\n            })\r\n          }else if(res.code == 200) {\r\n            // let id = cw.data.projectid\r\n            this.$router.push({\r\n              path: \"reportHouse3\",\r\n              query: {\r\n                projectId: e.projectid || '',\r\n                villageId: e.villageId || '',\r\n                sourceType: e.sourceType,\r\n                 projectName: e.projectName,\r\n                villageName: e.villageName,\r\n              }\r\n            });\r\n          }\r\n      })\r\n\r\n      }\r\n    })\r\n\r\n    let that = this\r\n    document.onmousewheel = e => {\r\n      this.zoom = that.map && that.map.getZoom()\r\n    };\r\n\r\n    // 计算满屏高度\r\n    setTimeout(() => {\r\n      this.calcFullHeight()\r\n    }, 500)\r\n  },\r\n  computed: {\r\n    ...mapState(['userInfo'])\r\n  },\r\n  methods: {\r\n    calcFullHeight() {\r\n      let h = document.documentElement.clientHeight\r\n      let headH = document.querySelector('.header-wrapper').clientHeight\r\n      let footH = document.querySelector('footer').clientHeight\r\n      let elHeaderH = document.querySelector('.el-header').clientHeight\r\n\r\n      document.querySelector('.mapBox').style.height = (h - headH - footH - elHeaderH - 2) + 'px'\r\n    },\r\n    initBMap (cb) {\r\n      // console.log(TMap);\r\n        var center = new TMap.LatLng(30.57024669280235, 114.30042924810527)\r\n            //定义map变量，调用 TMap.Map() 构造函数创建地图\r\n        var map = this.map = window.map = new TMap.Map(document.getElementById('allmap'), {\r\n            center: center,//设置地图中心点坐标\r\n            zoom: this.zoom,   //设置地图缩放级别\r\n        });\r\n\r\n        map.setDoubleClickZoom(false)\r\n        map.removeControl(\"zoom\")\r\n        map.removeControl(\"logo\")\r\n        console.log(this.map);\r\n    },\r\n    createLabel (data, layerType) {\r\n      let that = this\r\n      data.forEach(d => {\r\n        let label = new customOverlay({\r\n          map: that.map,\r\n          position: new TMap.LatLng(d.latitude, d.longitude),\r\n          data: d,\r\n          minRadius: 0,\r\n          maxRadius: 20,\r\n          contentName: d.regionName,\r\n          contentCount: d.count,\r\n          layerType\r\n        });\r\n\r\n      // console.log(label);\r\n        if(layerType == 'projectLabel') {\r\n          this.projectLabelArr.push(label)\r\n        }else{\r\n          this.areaLabelArr.push(label)\r\n        }\r\n      })\r\n    },\r\n\r\n    getData() {\r\n      countHouseForMap({}).then(res => {\r\n        // console.log(res);\r\n        const d = res.data;\r\n        if (d) {\r\n          this.areaData = d;\r\n          let arr = [];\r\n          d.forEach(e => {\r\n            if (e.childData && e.childData.length > 0) {\r\n              arr.push(...e.childData);\r\n            }\r\n          });\r\n          this.projectData = arr;\r\n\r\n          // this.initBMap()\r\n\r\n          // 区域\r\n          this.createLabel(this.areaData, 'areaLabel')\r\n          this.createLabel(this.projectData, 'projectLabel')\r\n\r\n          this.toggleAreaLabelArr()\r\n        }\r\n      });\r\n    },\r\n    toggleAreaLabelArr() {\r\n      if(this.isAreaMarkerVisible) {\r\n        this.areaLabelArr.forEach(label => {\r\n          label.dom.style.display = 'block'\r\n        })\r\n        this.projectLabelArr.forEach(label => {\r\n          label.dom.style.display = 'none'\r\n        })\r\n      }else{\r\n        this.areaLabelArr.forEach(label => {\r\n          label.dom.style.display = 'none'\r\n        })\r\n        this.projectLabelArr.forEach(label => {\r\n          label.dom.style.display = 'block'\r\n        })\r\n      }\r\n      this.isAreaMarkerVisible = !this.isAreaMarkerVisible\r\n    }\r\n  },\r\n  watch: {\r\n    // 区域marker对象的显影问题待研究，api无法实现显影交互\r\n    zoom(newV, oldV) {\r\n      if (newV >= 13 && !this.isAreaMarkerVisible) {\r\n        this.toggleAreaLabelArr()\r\n      }else if (newV <= 11.5 && this.isAreaMarkerVisible){\r\n        this.toggleAreaLabelArr()\r\n      }\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n#allmap {\r\n  width: 100%;\r\n  height: 500px;\r\n  position: relative;\r\n}\r\n\r\n#allmap {\r\n  & /deep/ .logo-text{\r\n    display: none;\r\n  }\r\n  & /deep/ .rotate-circle .compass-img{\r\n    left: 0;\r\n  }\r\n  & /deep/ .rotate-circle .rotate-left-img{\r\n    left: 0;\r\n  }\r\n  & /deep/ .rotate-circle .rotate-right-img{\r\n    left: 0;\r\n  }\r\n  & /deep/ .rotate-circle .rotate-top-img{\r\n    left: 0;\r\n  }\r\n  & /deep/ .rotate-circle .rotate-bottom-img{\r\n    left: 0;\r\n  }\r\n}\r\n\r\n.tooltip {\r\n  position: absolute;\r\n  top: 10px;\r\n  left: 50%;\r\n  // width: 100%;\r\n  height: 30px;\r\n  line-height: 30px;\r\n  text-align: center;\r\n  background: rgba(0, 0, 0, 0.3);\r\n  color: #f00;\r\n  z-index: 10000;\r\n  transform: translateX(-50%);\r\n  // width: 270px;\r\n  height: 46px;\r\n  background: #FFDCDC;\r\n  border: 1px solid #D10100;\r\n  box-shadow: 0px 0px 19px 1px rgba(209, 1, 0, 0.5);\r\n  border-radius: 10px;\r\n  display: flex;\r\n  align-items: center;\r\n  padding-right: 10px;\r\n  img {\r\n    width: 30px;\r\n    height: 30px;\r\n    margin-right: 10px;\r\n    margin-left: 10px;\r\n  }\r\n}\r\n.mapBox {\r\n  position: relative;\r\n  // min-height: 640px;\r\n  display: flex;\r\n  // align-items: center;\r\n}\r\n\r\n</style>\r\n"]}]}